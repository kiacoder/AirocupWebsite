<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <link
      rel="manifest"
      href="{{ url_for('static', filename=path.site_web_manifest) }}"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% set _is_admin = request.blueprint == 'admin' %}
    {% set _current_endpoint = request.endpoint or '' %}
    {% set _is_admin_auth = _is_admin and _current_endpoint in ['admin.admin_login'] %}
    <meta
      name="robots"
      content="{{ 'noindex, nofollow' if _is_admin else 'index, follow' }}"
    />

    <title>
      {% block title %}{{ page_title if page_title is defined else 'صفحه اصلی'
      }}{% endblock %} | آیروکاپ
    </title>

    {% if not _is_admin %}
    <meta
      name="description"
      content="{{ seo_description if seo_description is defined else 'آیروکاپ، بزرگترین رویداد ملی هوش مصنوعی و رباتیک ایران به میزبانی دانشگاه علم و صنعت. در لیگ‌های متنوع شرکت کنید، نوآوری کنید و آینده را بسازید.' }}"
    />
    <meta
      name="keywords"
      content="{{ seo_keywords if seo_keywords is defined else 'آیروکاپ, مسابقات هوش مصنوعی, رباتیک, دانشگاه علم و صنعت, مسابقات ملی, Airocup, AI competitions, robotics' }}"
    />
    <meta name="author" content="Airocup" />
    <meta name="theme-color" content="#7b4baa" />

    <meta
      property="og:title"
      content="{% block og_title %}{{ page_title|striptags|trim if page_title is defined else 'آیروکاپ' }}{% endblock %}"
    />
    <meta
      property="og:description"
      content="{{ seo_description if seo_description is defined else 'به بزرگترین رویداد هوش مصنوعی و رباتیک ایران به میزبانی دانشگاه علم و صنعت ایران بپیوندید.' }}"
    />
    <meta
      property="og:image"
      content="{{ url_for('static', filename=path.solid_logos['solid_purple_glow'], _external=True) }}"
    />
    <meta property="og:url" content="{{ request.base_url }}" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="fa_IR" />
    <meta property="og:site_name" content="آیروکاپ" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="{% block twitter_title %}{{ page_title|striptags|trim if page_title is defined else 'آیروکاپ' }}{% endblock %}"
    />
    <meta
      name="twitter:description"
      content="{{ seo_description if seo_description is defined else 'آیروکاپ، نخستین رویداد ملی هوش مصنوعی و رباتیک ایران' }}"
    />
    <meta
      name="twitter:image"
      content="{{ url_for('static', filename=path.solid_logos['solid_purple_glow'], _external=True) }}"
    />
    <meta name="twitter:site" content="{{ contact.instagram }}" />

    <link rel="canonical" href="{{ request.base_url }}" />
    <link rel="alternate" href="{{ request.base_url }}" hreflang="fa-IR" />
    {% endif %}

    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename=path.css_style, v=static_version) }}"
    />

    {% if not _is_admin %}
    <link
      rel="icon"
      href="{{ url_for('static', filename=path.solid_logos['solid_white_favicon'], v=static_version) }}"
      type="image/x-icon"
    />
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename=path.solid_logos['main_fest_192'], v=static_version) }}"
    />
    <link
      rel="apple-touch-icon"
      href="{{ url_for('static', filename=path.solid_logos['main_fest_192'], v=static_version) }}"
    />
    {% endif %}

    <!-- 
      FIX #1: Corrected 'xintegrity' typo to 'integrity'.
      This was the cause of the [GLOBAL] SyntaxError and stopped JS from loading.
    -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      xintegrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    {% block head %}{% endblock %}
  </head>

  <body
    class="{{ 'admin-body' if _is_admin else 'client-page' }}{{ ' admin-body--auth' if _is_admin_auth else '' }}"
    {%
    if
    not
    _is_admin
    %}
    data-client-id="{{ session.get('client_id', '') }}"
    {%
    endif
    %}
  >
    {% if _is_admin and not _is_admin_auth %}
    <!-- ================== -->
    <!--     ADMIN HEADER   -->
    <!-- ================== -->
    <header class="admin-header" data-header="admin">
      <div class="admin-header-container container">
        <a
          href="{{ url_for('admin.admin_dashboard') }}"
          class="admin-header-logo"
        >
          <img
            src="{{ url_for('static', filename=path.transparent_logos['transparent_white'], v=static_version) }}"
            alt="پنل مدیریت آیروکاپ"
          />
          <span>پنل مدیریت آیروکاپ</span>
        </a>

        <nav
          class="admin-header-nav"
          id="admin-nav"
          aria-label="منوی مدیریت"
        >
          <a
            href="{{ url_for('admin.admin_dashboard') }}"
            class="{{ 'active' if _current_endpoint == 'admin.admin_dashboard' else '' }}"
            {% if _current_endpoint == 'admin.admin_dashboard' %}aria-current="page"{% endif %}
            >داشبورد</a
          >
          <a
            href="{{ url_for('admin.admin_clients_list') }}"
            class="{{ 'active' if _current_endpoint == 'admin.admin_clients_list' else '' }}"
            {% if _current_endpoint == 'admin.admin_clients_list' %}aria-current="page"{% endif %}
            >کاربران</a
          >
          <a
            href="{{ url_for('admin.admin_manage_teams') }}"
            class="{{ 'active' if _current_endpoint == 'admin.admin_manage_teams' else '' }}"
            {% if _current_endpoint == 'admin.admin_manage_teams' %}aria-current="page"{% endif %}
            >تیم‌ها</a
          >
          <a
            href="{{ url_for('admin.admin_manage_news') }}"
            class="{{ 'active' if _current_endpoint == 'admin.admin_manage_news' else '' }}"
            {% if _current_endpoint == 'admin.admin_manage_news' %}aria-current="page"{% endif %}
            >اخبار</a
          >
          <a href="{{ url_for('global.logout') }}" class="btn btn-secondary"
            >خروج</a
          >
        </nav>

        <button
          class="admin-header-mobile-toggle"
          type="button"
          aria-controls="admin-nav"
          aria-expanded="false"
          aria-label="باز و بسته کردن منو"
        >
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
    </header>

    {% elif not _is_admin %}
    <!-- ================== -->
    <!--    CLIENT HEADER   -->
    <!-- ================== -->
    <header class="site-header">
      <div class="container header-inner">
        <!-- Logo (left) -->
        <div class="logo" aria-hidden="false">
          <a href="{{ url_for('global.index') }}">
            <img
              src="{{ url_for('static', filename=path.transparent_logos['transparent_white'], v=static_version) }}"
              alt="لوگو آیروکاپ"
            />
          </a>
        </div>

        <!-- Main navigation (visible on desktop) -->
        <nav
          class="main-nav"
          id="main-nav"
          role="navigation"
          aria-label="منوی اصلی"
        >
          <ul class="nav-list" id="nav-list" role="menubar">
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.index') }}"
                class="{{ 'active' if _current_endpoint == 'global.index' else '' }}"
                {% if _current_endpoint == 'global.index' %}aria-current="page"{% endif %}
                >صفحه اصلی</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.leagues') }}"
                class="{{ 'active' if _current_endpoint == 'global.leagues' else '' }}"
                {% if _current_endpoint == 'global.leagues' %}aria-current="page"{% endif %}
                >لیگ‌ها</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.committee') }}"
                class="{{ 'active' if _current_endpoint == 'global.committee' else '' }}"
                {% if _current_endpoint == 'global.committee' %}aria-current="page"{% endif %}
                >کمیته</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.sponsors') }}"
                class="{{ 'active' if _current_endpoint == 'global.sponsors' else '' }}"
                {% if _current_endpoint == 'global.sponsors' %}aria-current="page"{% endif %}
                >حامیان</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.gallery') }}"
                class="{{ 'active' if _current_endpoint == 'global.gallery' else '' }}"
                {% if _current_endpoint == 'global.gallery' %}aria-current="page"{% endif %}
                >گالری</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.news') }}"
                class="{{ 'active' if _current_endpoint == 'global.news' else '' }}"
                {% if _current_endpoint == 'global.news' %}aria-current="page"{% endif %}
                >اخبار</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.about') }}"
                class="{{ 'active' if _current_endpoint == 'global.about' else '' }}"
                {% if _current_endpoint == 'global.about' %}aria-current="page"{% endif %}
                >درباره ما</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.contact') }}"
                class="{{ 'active' if _current_endpoint == 'global.contact' else '' }}"
                {% if _current_endpoint == 'global.contact' %}aria-current="page"{% endif %}
                >تماس با ما</a
              >
            </li>
          </ul>
        </nav>

        <!-- Primary actions (visible on desktop) -->
        <div class="header-actions" id="header-actions">
          {% if 'client_id' in session %}
          <a href="{{ url_for('client.dashboard') }}" class="btn btn-secondary"
            >داشبورد</a
          >
          <a href="{{ url_for('client.support_chat') }}" class="btn btn-primary"
            >پشتیبانی</a
          >
          {% else %}
          <a
            href="{{ url_for('client.login_client') }}"
            class="btn btn-secondary"
            >ورود</a
          >
          <a href="{{ url_for('client.signup') }}" class="btn btn-primary"
            >ثبت‌نام</a
          >
          {% endif %}
        </div>

        <!-- Hamburger (visible on mobile) -->
        <button
          class="mobile-menu-btn"
          id="mobile-menu-btn"
          aria-label="منوی موبایل"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <span class="hamburger">
            <span></span><span></span><span></span>
          </span>
        </button>
      </div>

      <!-- Mobile Menu (hidden by default) -->
      <div
        id="mobile-menu"
        class="mobile-menu"
        aria-hidden="true"
        role="dialog"
        aria-modal="true"
      >
        <div class="mobile-menu-inner">
          
          <!-- Server-rendered fallback list; JS keeps it in sync when available -->
          <ul class="mobile-nav-list" id="mobile-nav-list" role="menu">
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.index') }}"
                class="{{ 'active' if _current_endpoint == 'global.index' else '' }}"
                {% if _current_endpoint == 'global.index' %}aria-current="page"{% endif %}
                >صفحه اصلی</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.leagues') }}"
                class="{{ 'active' if _current_endpoint == 'global.leagues' else '' }}"
                {% if _current_endpoint == 'global.leagues' %}aria-current="page"{% endif %}
                >لیگ‌ها</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.sponsors') }}"
                class="{{ 'active' if _current_endpoint == 'global.sponsors' else '' }}"
                {% if _current_endpoint == 'global.sponsors' %}aria-current="page"{% endif %}
                >حامیان</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.gallery') }}"
                class="{{ 'active' if _current_endpoint == 'global.gallery' else '' }}"
                {% if _current_endpoint == 'global.gallery' %}aria-current="page"{% endif %}
                >گالری</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.news') }}"
                class="{{ 'active' if _current_endpoint == 'global.news' else '' }}"
                {% if _current_endpoint == 'global.news' %}aria-current="page"{% endif %}
                >اخبار</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.about') }}"
                class="{{ 'active' if _current_endpoint == 'global.about' else '' }}"
                {% if _current_endpoint == 'global.about' %}aria-current="page"{% endif %}
                >درباره ما</a
              >
            </li>
            <li role="none">
              <a
                role="menuitem"
                href="{{ url_for('global.contact') }}"
                class="{{ 'active' if _current_endpoint == 'global.contact' else '' }}"
                {% if _current_endpoint == 'global.contact' %}aria-current="page"{% endif %}
                >تماس با ما</a
              >
            </li>
          </ul>

          <!-- Mobile-only CTAs -->
          <div class="mobile-cta">
            {% if 'client_id' in session %}
            <a
              href="{{ url_for('client.dashboard') }}"
              class="btn btn-secondary"
              >داشبورد</a
            >
            <a
              href="{{ url_for('client.support_chat') }}"
              class="btn btn-primary"
              >پشتیبانی</a
            >
            {% else %}
            <a
              href="{{ url_for('client.login_client') }}"
              class="btn btn-secondary"
              >ورود</a
            >
            <a href="{{ url_for('client.signup') }}" class="btn btn-primary"
              >ثبت‌نام</a
            >
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Backdrop for mobile menu -->
      <div
        id="mobile-menu-backdrop"
        class="mobile-menu-backdrop"
        aria-hidden="true"
      ></div>
    </header>

    {% endif %} 
    
    <!-- ================== -->
    <!--  FLASH MESSAGES    -->
    <!-- ================== -->

    <!-- 
      FIX #2: Moved the <div id="flash-container"> *OUTSIDE* the 'if' block.
      This ensures the container always exists for JavaScript to add messages to,
      fixing the "silent reload" bug on the signup page.
    -->
    <div id="flash-container" aria-live="polite" aria-atomic="true">
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% set category_map = { 
          'success': {'icon': 'fa-check-circle', 'class': 'flash-success'}, 
          'error': {'icon': 'fa-exclamation-triangle', 'class': 'flash-error'}, 
          'warning': {'icon': 'fa-exclamation-circle', 'class': 'flash-warning'}, 
          'info': {'icon': 'fa-info-circle', 'class': 'flash-info'} 
        } %} 
        {% for category, message in messages %} 
          {% set flash = category_map.get(category, category_map['info']) %}
          <div class="flash-message {{ flash.class }}" role="alert">
            <i class="fas {{ flash.icon }}" aria-hidden="true"></i>
            <span>{{ message }}</span>
            <button
              class="flash-close-btn"
              data-action="dismiss-flash"
              aria-label="بستن اعلان"
            >
              &times;
            </button>
          </div>
        {% endfor %}
      {% endif %}
      {% endwith %}
    </div>

    <!-- ================== -->
    <!--   MAIN CONTENT     -->
    <!-- ================== -->
    <main class="main-content">
      {% block breadcrumbs %}{% endblock %}
      {% block body %}{% endblock %}
    </main>

    <!-- Global confirmation modal available to every page -->
    <div
      class="modal"
      id="confirmationModal"
      role="alertdialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <button class="close-btn" data-dismiss="modal" aria-label="بستن">
            &times;
          </button>
          <h3 id="modalTitle" class="modal-title"></h3>
          <p class="modal-body"></p>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
              انصراف
            </button>
            <button type="button" id="confirmModalBtn" class="btn btn-danger">
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ================== -->
    <!--       FOOTER       -->
    <!-- ================== -->
    {% if not _is_admin %}
    <footer class="site-footer">
      <!-- Top Blue Line -->
      <div class="footer-top-line"></div>

      <div class="container footer-content">
        <!-- Footer Cards -->
        <div class="footer-cards">
          <!-- Quick Access -->
          <!-- 
            FIX #4: Changed class 'fade-up' to 'fade-in-element'
            to match the selector in main.js (ui.initializeLazyLoad)
          -->
          <div class="footer-card fade-in-element">
            <h3 style="color: var(--color-header)">دسترسی سریع</h3>
            <ul>
              <li><a href="{{ url_for('global.index') }}">صفحه اصلی</a></li>
              <li><a href="{{ url_for('global.leagues') }}">لیگ‌ها</a></li>
              <li><a href="{{ url_for('client.signup') }}">ثبت‌نام</a></li>
              <li><a href="{{ url_for('client.login_client') }}">ورود</a></li>
              <li><a href="{{ url_for('global.news') }}">اخبار</a></li>
              <li><a href="{{ url_for('global.about') }}">درباره ما</a></li>
              <li><a href="{{ url_for('global.contact') }}">تماس با ما</a></li>
              <li>
                <a href="{{ url_for('global.cooperate') }}">همکاری با ما</a>
              </li>
            </ul>
          </div>

          <!-- Logo and Description -->
          <div class="footer-card fade-in-element delay-1">
            <img
              src="{{ url_for('static', filename=path.transparent_logos['transparent_white'], v=static_version) }}"
              alt="لوگو آیروکاپ"
              class="footer-logo"
            />
            <p>
              آیروکاپ، پیشگام در آینده هوشمند ایران — نخستین رویداد ملی هوش
              مصنوعی و رباتیک کشور.
            </p>
          </div>

          <!-- Contact Info -->
          <div class="footer-card fade-in-element delay-2">
            <h3 style="color: var(--color-header)">اطلاعات تماس</h3>
            <p>
              <i class="fas fa-map-marker-alt"></i> تهران، دانشگاه علم و صنعت
              ایران
            </p>
            <p><i class="fas fa-phone"></i> {{ contact.phone }}</p>
            <div class="social-icons">
              <a
                href="https://instagram.com/{{ contact.instagram|replace('@','') }}"
                target="_blank" 
                rel="noopener noreferrer"
                aria-label="اینستاگرام آیروکاپ"
                ><i class="fab fa-instagram"></i
              ></a>
              <a 
                href="{{ contact.bale }}" 
                target="_blank" 
                rel="noopener noreferrer"
                aria-label="کانال بله آیروکاپ"
                ><i class="fas fa-comment-dots"></i
              ></a>
              <a 
                href="{{ contact.aparat_playlist }}" 
                target="_blank" 
                rel="noopener noreferrer"
                aria-label="کانال آپارات آیروکاپ"
                ><i class="fas fa-play-circle"></i
              ></a>
            </div>
          </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
          <p>
            &copy; {{ jdatetime.datetime.now().year }} تمامی حقوق برای
            <strong>آیروکاپ</strong> محفوظ است.
          </p>
          <p class="site-version">نسخه: {{ app_version }}</p>
        </div>
      </div>
    </footer>

    {% endif %}

    <!-- ================== -->
    <!-- GLOBAL SCRIPT TAGS -->
    <!-- ================== -->
    <script
      src="{{ url_for('static', filename='js/socket.io.min.js', v=static_version) }}"
      defer
    ></script>
    <script
      src="{{ url_for('static', filename='js/chart.umd.min.js', v=static_version) }}"
      defer
    ></script>

    {% if not _is_admin %}
    <script>
      window.AirocupData = {{ airocup_data | tojson | safe }};
    </script>
    {% endif %}
    
    <script
      src="{{ url_for('static', filename=path.js_main, v=static_version) }}"
      defer
    ></script>
    
    {% block scripts %}
    <!-- Page-specific scripts can be inserted here -->

    <!-- 
      FIX #4: Removed the redundant inline IntersectionObserver script.
      main.js (ui.initializeLazyLoad) now handles this.
    -->
    
    {% endblock %}
  </body>
</html>