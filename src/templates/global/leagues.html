{% extends "global/base.html" %}
{% block title %}لیگ‌ها | آیروکاپ{% endblock %}

{% block seo_description %}
<meta
  name="description"
  content="آشنایی با ۱۴ لیگ جذاب و نوآورانه مسابقات ملی هوش مصنوعی و رباتیک آیروکاپ. لیگ‌های تخصصی برای دانش‌آموزان و دانشجویان."
/>
{% endblock %}

{% block body %}
<main class="app-container leagues-page">
  <div class="container">

    <!-- Page Header -->
    <header class="page-header text-center">
      <h1 class="section-title">لیگ‌های مسابقات آیروکاپ</h1>

      <p class="page-subtitle">
        برای مشاهده جزئیات کامل، آئین‌نامه‌ها و قوانین هر لیگ، می‌توانید سند
        راهنمای جامع را از طریق دکمه زیر دانلود کنید.
      </p>

      <a href="{{ url_for('global.download_pdf') }}" class="btn btn-primary btn-large">
        <i class="fas fa-file-pdf" aria-hidden="true"></i>
        دانلود راهنمای کامل لیگ‌ها (PDF)
      </a>
    </header>

    <!-- Filter -->
    <div class="league-filter-container">
      <div class="input-group">
        <i class="fas fa-search input-icon"></i>
        <input
          type="search"
          id="leagueFilter"
          class="form-control"
          placeholder="جستجو در نام یا توضیحات لیگ‌ها..."
        />
      </div>
    </div>

    <!-- Accordion -->
    <section class="accordion-container" aria-label="لیست لیگ‌های مسابقات">
      {% for league in leagues_list %}
      <div class="card accordion-item">

        <div class="accordion-header">
          <button
            class="accordion-button"
            aria-expanded="false"
            aria-controls="league-panel-{{ league.id }}"
            id="league-header-{{ league.id }}"
          >
            <span class="accordion-title">
              <i class="fas {{ league.icon }}" aria-hidden="true"></i>
              {{ league.name }}
            </span>

            <i class="fas fa-chevron-down accordion-icon" aria-hidden="true"></i>
          </button>
        </div>

        <div
          id="league-panel-{{ league.id }}"
          class="accordion-content"
          role="region"
          aria-labelledby="league-header-{{ league.id }}"
        >
          <div class="league-details-body">
            <p>{{ league.description }}</p>
          </div>
        </div>

      </div>
      {% endfor %}

      <!-- No Results -->
      <div id="noResultsMessage" class="card empty-state-card" style="display: none">
        <i class="fas fa-search empty-state-icon"></i>
        <h3>هیچ لیگی با عبارت جستجو شده مطابقت ندارد.</h3>
        <p>لطفاً عبارت دیگری را امتحان کنید.</p>
      </div>

    </section>

    <!-- Final CTA -->
    <section class="cta-section text-center">
      <h2>آماده رقابت هستید؟</h2>
      <p>
        به بزرگترین رویداد هوش مصنوعی و رباتیک ایران بپیوندید و مهارت‌های خود را
        به نمایش بگذارید!
      </p>

      <a href="{{ url_for('client.signup') }}" class="btn btn-primary btn-large">
        <i class="fas fa-rocket" aria-hidden="true"></i>
        همین حالا ثبت‌نام کنید
      </a>
    </section>

  </div>
</main>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.airocupApp && window.airocupApp.client) {
      return;
    }

    const container = document.querySelector(".accordion-container");
    const filterInput = document.querySelector("#leagueFilter");
    const noResultsMessage = document.querySelector("#noResultsMessage");

    if (!container) return;

    const accordionButtons = container.querySelectorAll(".accordion-button");
    const accordionItems = container.querySelectorAll(".accordion-item");

    container.addEventListener("click", (event) => {
      const button = event.target.closest(".accordion-button");
      if (!button) return;

      const isExpanded = button.getAttribute("aria-expanded") === "true";
      accordionButtons.forEach((otherButton) => {
        if (otherButton === button) return;
        otherButton.setAttribute("aria-expanded", "false");
        const otherContent = document.getElementById(
          otherButton.getAttribute("aria-controls") || ""
        );
        if (otherContent) {
          otherContent.style.maxHeight = null;
        }
      });

      button.setAttribute("aria-expanded", String(!isExpanded));
      const content = document.getElementById(
        button.getAttribute("aria-controls") || ""
      );
      if (content) {
        content.style.maxHeight = isExpanded ? null : `${content.scrollHeight}px`;
      }
    });

    const openFromHash = () => {
      const { hash } = window.location;
      if (!hash) return;
      const button = document.querySelector(hash);
      if (button && button.classList.contains("accordion-button")) {
        button.click();
        button.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    };

    openFromHash();
    window.addEventListener("hashchange", openFromHash);

    if (filterInput) {
      filterInput.addEventListener("input", (event) => {
        const term = event.target.value.toLowerCase().trim();
        let visibleCount = 0;

        accordionItems.forEach((item) => {
          const matches = item.textContent.toLowerCase().includes(term);
          item.style.display = matches ? "" : "none";
          if (matches) visibleCount += 1;
        });

        if (noResultsMessage) {
          noResultsMessage.style.display = visibleCount === 0 ? "" : "none";
        }
      });
    }
  });
</script>
{% endblock %}
