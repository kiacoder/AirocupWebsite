{% extends "global/base.html" %}

{% block title %}تاریخچه پرداخت‌ها{% endblock %}

{% block body %}
<main class="app-container">
  <div class="container">
    <header class="page-header">
      <h1 class="page-title">تاریخچه پرداخت‌ها</h1>
      <p class="page-subtitle">
        در این بخش می‌توانید تمام پرداخت‌های انجام شده و وضعیت آن‌ها را مشاهده کنید.
      </p>
    </header>

    <section class="card card--table">
      <header class="card-header">
        <h2>لیست تراکنش‌ها</h2>
      </header>
      {% if payments %}
      <div class="user-table-wrapper">
        <table class="user-table">
          <thead>
            <tr>
              <th>نام تیم</th>
              <th>مبلغ (ریال)</th>
              <th>تاریخ</th>
              <th>وضعیت</th>
              <th>رسید</th>
            </tr>
          </thead>
          <tbody>
            {% for p in payments %}
            <tr>
              <td data-label="نام تیم">{{ p.team_name }}</td>
              <td data-label="مبلغ">
                {{ p.amount | humanize_number | persian_digits }}
              </td>
              <td data-label="تاریخ">
                {{ p.upload_date | formatdate | persian_digits }}
              </td>
              <td data-label="وضعیت">
                {% set status_class = {
                  'approved': 'status-approved',
                  'pending': 'status-pending',
                  'rejected': 'status-rejected'
                }.get(p.status.value, 'status-not-started') %}
                <span class="status-badge {{ status_class }}">
                  {{ p.status.label }}
                </span>
              </td>
              <td data-label="رسید">
                {% if p.receipt_filename %}
                <a
                  href="{{ url_for('client.get_receipt', client_id=p.client_id, filename=p.receipt_filename) }}"
                  class="btn btn-secondary btn-sm"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <i class="fas fa-receipt" aria-hidden="true"></i>
                  مشاهده
                </a>
                {% else %}
                <span>-</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="card empty-state-card">
        <i class="fas fa-history empty-state-icon" aria-hidden="true"></i>
        <h3>سابقه پرداخت خالی است</h3>
        <p>شما هنوز هیچ پرداختی انجام نداده‌اید.</p>
      </div>
      {% endif %}
    </section>

    <div class="section-cta">
      <a href="{{ url_for('client.dashboard') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left" aria-hidden="true"></i>
        بازگشت به داشبورد
      </a>
    </div>
  </div>
</main>
{% endblock %}
