{% extends "global/base.html" %} {% block title %}مدیریت اعضای تیم: {{
team.team_name }}{% endblock %} {% block body %}
<div class="members-page" data-team-id="{{ team.team_id }}">
  <div class="container" style="margin: 2rem auto">
    <div class="section-header" style="margin-bottom: 2rem">
      <h1 class="section-title">تیم شما: {{ team.team_name }}</h1>
      <p class="form-subtitle" style="margin-bottom: 0">
        در این بخش اعضای تیم خود را اضافه، ویرایش یا حذف کنید.
      </p>
    </div>

    {% if is_paid and team.unpaid_members_count > 0 %}
    <div class="alert alert--warning" role="alert">
      <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
      <p>
        <strong>توجه:</strong>
        شما {{ team.unpaid_members_count | persian_digits }} عضو جدید اضافه
        کرده‌اید که هزینه آن‌ها پرداخت نشده است. لطفاً برای نهایی کردن ثبت‌نام
        آن‌ها به
        <a href="{{ url_for('client.payment', team_id=team.team_id) }}"
          >صفحه پرداخت</a
        >
        مراجعه کنید.
      </p>
    </div>
    {% endif %}

    <div class="card card--table" style="margin-bottom: 2rem">
      <h2 style="padding: 1.5rem 1.5rem 0; font-size: 1.4rem; font-weight: 700">
        اعضای فعلی ({{ members|length | persian_digits }} از {{
        app_config.max_members_per_team | persian_digits }})
      </h2>

      <div
        style="
          padding: 0 1.5rem 1rem;
          border-bottom: 1px solid var(--color-border-muted);
        "
      >
        <div style="margin-bottom: 0.5rem">
          <span style="font-weight: 600; color: var(--color-text-muted)"
            >مقطع تحصیلی تیم:</span
          >
          {% if team.education_level %}
          <strong style="color: var(--color-primary)"
            >{{ team.education_level }}</strong
          >
          {% set level_info = education_levels.get(team.education_level) %}
          {% if level_info and level_info.get('ages') %}
          <span style="color: var(--color-text-muted); margin-right: 0.75rem">
            بازه سنی مجاز: {{ level_info.get('ages')[0] | persian_digits }} تا
            {{ level_info.get('ages')[1] | persian_digits }} سال
          </span>
          {% endif %}
          {% else %}
          <strong style="color: var(--color-error)">هنوز انتخاب نشده</strong>
          {% endif %}
        </div>
        <div>
          <span style="font-weight: 600; color: var(--color-text-muted)"
            >لیگ‌های فعال:</span
          >
          {% if team.league_one %}
          <strong style="color: var(--color-primary)"
            >{{ team.league_one.name }}</strong
          >
          {% if team.league_two %}
          <span style="color: var(--color-text-muted)">&</span>
          <strong style="color: var(--color-primary)"
            >{{ team.league_two.name }}</strong
          >
          {% endif %}
          {% else %}
          <strong style="color: var(--color-error)">هنوز انتخاب نشده</strong>
          {% endif %}
        </div>
      </div>

      <div class="user-table-wrapper">
        <table class="user-table">
          <thead>
            <tr>
              <th>نام و نام خانوادگی</th>
              <th>نقش</th>
              <th>کد ملی</th>
              <th class="actions-header">عملیات</th>
            </tr>
          </thead>
          <tbody>
            {% for member in members %}
            <tr>
              <td data-label="نام">{{ member.name }}</td>
              <td data-label="نقش">{{ member.role.label }}</td>
              <td data-label="کد ملی" dir="ltr">
                {{ member.national_id | persian_digits or '-' }}
              </td>
              <td class="actions">
                <a
                  href="{{ url_for('client.edit_member', team_id=team.team_id, member_id=member.member_id) }}"
                  class="btn btn-secondary btn-sm"
                >
                  <i class="fas fa-edit"></i> ویرایش
                </a>
                <form
                  action="{{ url_for('client.delete_member', team_id=team.team_id, member_id=member.member_id) }}"
                  method="POST"
                  style="display: inline"
                >
                  <input
                    type="hidden"
                    name="csrf_token"
                    value="{{ csrf_token() }}"
                  />
                  <button
                    type="button"
                    class="btn btn-danger btn-sm delete-btn"
                    data-modal-title="تایید حذف عضو"
                    data-modal-body="آیا از حذف «{{ member.name }}» اطمینان دارید؟"
                    data-modal-confirm-text="بله، حذف کن"
                    {%
                    if
                    has_any_payment
                    %}
                    disabled
                    title="پس از ارسال رسید پرداخت (در انتظار تایید/تایید شده/رد شده)، امکان حذف عضو فقط برای ادمین وجود دارد."
                    {%
                    endif
                    %}
                  >
                    <i class="fas fa-trash"></i> حذف
                  </button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr class="empty-state-row">
              <td colspan="4" class="empty-state">
                <i
                  class="fas fa-users-slash empty-state__icon"
                  aria-hidden="true"
                ></i>
                این تیم هنوز عضوی ندارد.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {% if not team.education_level or not team.league_one_id %}
    <div class="alert alert--warning" role="alert" style="text-align: center">
      <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
      <p style="font-weight: 600; font-size: 1.1rem; margin-top: 0.5rem">
        مرحله بعد: انتخاب مقطع تحصیلی و لیگ
      </p>
      <p>
        برای افزودن اعضا، ابتدا باید مقطع تحصیلی و حداقل یک لیگ برای تیم خود
        انتخاب کنید.
      </p>
      <a
        href="{{ url_for('client.select_league', team_id=team.team_id) }}"
        class="btn btn-primary"
        style="margin-top: 1rem"
      >
        <i class="fas fa-trophy"></i> برو به صفحه انتخاب لیگ
      </a>
    </div>

    {% elif members|length < app_config.max_members_per_team %}
    <div
      class="form-container"
      id="addMemberFormContainer"
      style="margin-bottom: 2rem"
    >
      <h2 class="form-title">افزودن عضو جدید</h2>
      <form
        method="POST"
        action="{{ url_for('client.add_member', team_id=team.team_id) }}"
        id="addMemberForm"
        novalidate
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        {% with id_prefix='add-', member_data=None, form_data=form_data %} {%
        include 'client/member_form_fields.html' %} {% endwith %}

        <div class="form-group">
          <button type="submit" class="btn btn-primary btn--full-width">
            افزودن عضو
          </button>
        </div>
      </form>
    </div>
    {% endif %}
    <div style="text-align: center; margin-bottom: 2rem">
      <a href="{{ url_for('client.dashboard') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> بازگشت به داشبورد
      </a>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %} {{ super() }} {% endblock %}
