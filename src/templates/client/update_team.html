{% extends "global/base.html" %} {% block title %}ویرایش تیم: {{ team.team_name
}}{% endblock %} {% block head %}
{% endblock %} {% block body %}
<div class="app-container">
  <div class="container">
    <div class="page-header">
      <h1 class="section-title">
        ویرایش تیم:
        <span style="color: var(--color-primary)">{{ team.team_name }}</span>
      </h1>
      <p class="section-subtitle">
        در این بخش می‌توانید نام تیم خود را تغییر دهید و در صورت تایید پرداخت،
        مستندات پروژه را بارگذاری کنید.
      </p>
    </div>

    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" data-tab="edit-info">
          <i class="fas fa-edit"></i> ویرایش نام
        </button>

        <button
          class="tab-button"
          data-tab="documents"
          {%
          if
          not
          is_payment_approved
          %}
          disabled
          title="برای فعال‌سازی، پرداخت تیم باید تایید شده باشد."
          {%
          endif
          %}
        >
          <i class="fas fa-file-upload"></i> ارسال مستندات {% if not
          is_payment_approved %}(<i class="fas fa-lock"></i>){% endif %}
        </button>
      </div>

      <div id="edit-info" class="tab-content active">
        <div
          class="form-container form-container--medium"
          style="margin-top: 1rem"
        >
          <h2 class="form-title">تغییر نام تیم</h2>

          <form
            method="POST"
            action="{{ url_for('client.update_team', team_id=team.team_id) }}"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

            <div class="form-group">
              <label for="teamName">
                نام جدید تیم:<span class="required-star">*</span>
              </label>

              <input
                type="text"
                id="teamName"
                name="team_name"
                value="{{ team.team_name }}"
                required
                minlength="3"
                maxlength="30"
                {%
                if
                has_any_payment
                %}disabled{%
                endif
                %}
              />

              {% if has_any_payment %}
              <small
                style="
                  display: block;
                  margin-top: 8px;
                  color: var(--color-text-muted);
                "
              >
                <i class="fas fa-info-circle"></i>
                پس از ارسال رسید پرداخت، تغییر نام تیم فقط توسط ادمین امکان‌پذیر است.
              </small>
              {% endif %}
            </div>

            <div class="form-group">
              {% if not has_any_payment %}
              <button type="submit" class="btn btn-primary btn--full-width">
                ذخیره نام جدید
              </button>
              {% endif %}
            </div>
          </form>
        </div>
      </div>

      <div id="documents" class="tab-content">
        {% if is_payment_approved %}
        <div
          class="form-container form-container--medium"
          style="margin-top: 1rem"
        >
          <h2 class="form-title">بارگذاری مستندات</h2>
          <p class="form-subtitle" style="font-size: 0.9rem">
            فایل‌های پروژه مانند ویدئو، پوستر، فایل‌های متنی و... را بارگذاری
            کنید.
          </p>

          <form
            id="document-upload-form"
            method="POST"
            action="{{ url_for('client.upload_document', team_id=team.team_id) }}"
            enctype="multipart/form-data"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

            <div class="form-group">
              <label
                for="documentFile"
                class="btn btn-secondary file-upload-btn"
              >
                <i class="fas fa-paperclip"></i> انتخاب فایل
              </label>

              <input
                type="file"
                id="documentFile"
                name="file"
                class="file-upload-input"
                required
              />
              <span id="filename" class="file-name-display">
                هیچ فایلی انتخاب نشده
              </span>

              <small
                style="display: block; margin-top: 10px; text-align: center"
              >
                حداکثر حجم مجاز: ویدئو تا ۲۰۰ مگابایت، تصویر و فایل‌های متنی/آفیس تا ۵۰ مگابایت.
              </small>
            </div>

            <button type="submit" class="btn btn-primary btn--full-width">
              بارگذاری فایل
            </button>
          </form>
        </div>

        <hr style="margin: 2.5rem 0" />

        <h3>مستندات بارگذاری شده</h3>

        {% if is_documents_approved %}
        <div style="background-color: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #c3e6cb; text-align: center;">
            <i class="fas fa-check-circle"></i>
            <strong>تبریک!</strong> مدارک شما تایید شد و شما به مرحله بعدی راه یافتید.
        </div>
        {% endif %}

        {% if is_documents_rejected %}
        <div style="background-color: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f5c6cb; text-align: center;">
            <i class="fas fa-times-circle"></i>
            <strong>متاسفانه مدارک شما تایید نشد.</strong> لطفاً مدارک صحیح را مجدداً بارگذاری کنید یا با پشتیبانی تماس بگیرید.
        </div>
        {% endif %}

        {% if documents %}
        <div class="user-table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>نام فایل</th>
                <th>نوع</th>
                <th>تاریخ</th>
                <th>وضعیت</th>
                <th>دانلود</th>
              </tr>
            </thead>
            <tbody>
              {% for doc in documents %}
              <tr>
                <td>{{ doc.file_name | truncate(40) }}</td>
                <td>{{ doc.file_type }}</td>
                <td>{{ doc.upload_date | formatdate }}</td>
                <td>
                  <span class="status-badge {% if doc.status.value == 'approved' %}status-approved{% elif doc.status.value == 'rejected' %}status-rejected{% else %}status-pending{% endif %}">
                    {{ doc.status.label }}
                  </span>
                </td>
                <td>
                  <a
                    href="{{ url_for('client.get_document', team_id=doc.team_id, filename=doc.file_name) }}"
                    class="btn btn-sm btn-secondary"
                    download
                  >
                    <i class="fas fa-download"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p style="text-align: center; margin-top: 1rem">
          هنوز هیچ مستنداتی برای این تیم بارگذاری نشده است.
        </p>
        {% endif %} {% else %}
        <div style="text-align: center; padding: 2rem">
          <i class="fas fa-lock" style="font-size: 2.5rem; color: #aaa"></i>
          <h3 style="margin-top: 1.5rem">بخش مستندات قفل است</h3>
          <p style="color: var(--color-text-muted)">
            این بخش پس از پرداخت هزینه تیم و
            <strong>تایید نهایی</strong> فعال خواهد شد.
          </p>
        </div>
        {% endif %}
      </div>
    </div>

    <div
      class="section-cta"
      style="text-align: center; margin-top: 2rem; margin-bottom: 30px"
    >
      <a href="{{ url_for('client.dashboard') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> بازگشت به داشبورد
      </a>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");

    tabButtons.forEach((button) => {
      if (button.disabled) return;

      button.addEventListener("click", () => {
        tabButtons.forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");

        const tabId = button.dataset.tab;
        tabContents.forEach((content) => {
          content.classList.toggle("active", content.id === tabId);
        });
      });
    });

    const fileInput = document.getElementById("documentFile");
    const filenameDisplay = document.getElementById("filename");

    if (fileInput && filenameDisplay) {
      fileInput.addEventListener("change", () => {
        filenameDisplay.textContent =
          fileInput.files.length > 0
            ? fileInput.files[0].name
            : "هیچ فایلی انتخاب نشده";
      });
    }
  });
</script>
{% endblock %}
