{% extends "global/base.html" %}

{% block title %}مدیریت جامع تیم‌ها | پنل آیروکاپ{% endblock %}

{% block body %}
<div class="admin-page">
  <header class="admin-page__header">
    <div class="admin-page__title">
      <h1>مدیریت جامع تیم‌ها</h1>
      <p class="admin-page__subtitle">
        تمام تیم‌های فعال در سامانه را مشاهده کنید، وضعیت پرداخت‌ها را بررسی کنید و به صفحه مدیریت اختصاصی هر تیم دسترسی پیدا کنید.
      </p>
    </div>
    <div class="admin-page__actions">
      <span class="admin-badge">
        <i class="fas fa-users"></i>
        {{ teams|length | persian_digits }} تیم فعال
      </span>
    </div>
  </header>

  <section class="admin-page__section">
    <article class="admin-surface">
      <header class="admin-surface__header">
        <div class="admin-surface__title">
          <h2><i class="fas fa-layer-group"></i> لیست تیم‌ها</h2>
          <p>خلاصه‌ای از آخرین وضعیت تیم‌ها به‌همراه اطلاعات مالک و آخرین پرداخت.</p>
        </div>
      </header>
      <div class="admin-surface__body">
        <div class="admin-table-wrapper">
          <table class="admin-table">
            <thead>
              <tr>
                <th>نام تیم</th>
                <th>کاربر مالک</th>
                <th>تعداد اعضا</th>
                <th>آخرین وضعیت پرداخت</th>
                <th>عملیات</th>
              </tr>
            </thead>
            <tbody>
              {% for team in teams %}
              {% set status_enum = team.last_payment_status %}
              {% set status_value = status_enum.value if status_enum else None %}
              <tr>
                <td>
                  <strong>{{ team.team_name }}</strong><br />
                  <small class="admin-page__lead">کد تیم: #{{ team.team_id | persian_digits }}</small>
                </td>
                <td>{{ team.client_email }}</td>
                <td>{{ team.member_count | persian_digits }} نفر</td>
                <td>
                  <span
                    class="admin-status {% if status_value == 'approved' %}admin-status--approved{% elif status_value == 'pending' %}admin-status--pending{% elif status_value == 'rejected' %}admin-status--rejected{% else %}admin-status--idle{% endif %}"
                  >
                    <i class="fas fa-circle"></i>
                    {{ status_enum.label if status_enum else 'منتظر اقدام' }}
                  </span>
                </td>
                <td class="admin-table__actions">
                  <a
                    href="{{ url_for('admin.admin_edit_team', team_id=team.team_id) }}"
                    class="btn btn-primary btn-small"
                    title="مدیریت کامل تیم"
                  >
                    <i class="fas fa-edit"></i>
                    مدیریت تیم
                  </a>
                </td>
              </tr>
              {% else %}
              <tr class="admin-table__empty">
                <td colspan="5">
                  <div class="admin-empty-state">
                    <i class="fas fa-layer-group"></i>
                    هنوز هیچ تیمی در سیستم ثبت نشده است.
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </article>
  </section>

  <footer class="admin-page__footer">
    <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-right"></i>
      بازگشت به داشبورد
    </a>
  </footer>
</div>
{% endblock %}
