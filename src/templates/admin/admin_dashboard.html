{% extends "Global/Base.html" %} {% block Title %}داشبورد مدیریت | پنل آیروکاپ{%
endblock %} {% block Body %}
<div class="Container">
  <div class="PageHeader" style="margin-top: 5rem">
    <h1 class="SectionTitle">داشبورد مدیریت آیروکاپ</h1>
  </div>

  <div class="QuickLinks">
    <a
      href="{{ url_for('admin.admin_manage_client', client_id=Client.ClientID) }}"
      class="Btn BtnSecondary"
    >
      <i class="fas fa-users"></i> مدیریت کاربران
    </a>
    <a href="{{ url_for('admin.admin_manage_news') }}" class="Btn BtnSecondary">
      <i class="fas fa-newspaper"></i> مدیریت اخبار
    </a>
    <a href="{{ url_for('admin.admin_select_chat') }}" class="Btn BtnSecondary">
      <i class="fas fa-envelope"></i> پیام‌ها
    </a>
    <a
      href="{{ url_for('admin.admin_manage_teams') }}"
      class="Btn BtnSecondary"
    >
      <i class="fas fa-layer-group"></i> مدیریت تیم‌ها
    </a>
  </div>

  <div class="StatsGrid">
    <div class="Card StatCard">
      <div class="StatIcon StatIcon--members"><i class="fas fa-users"></i></div>
      <div class="StatContent">
        <h3>{{ Stats.TotalMembers | persian_digits or '۰' }}</h3>
        <p>کل شرکت کنندگان</p>
      </div>
    </div>
    <div class="Card StatCard">
      <div class="StatIcon StatIcon--teams">
        <i class="fas fa-layer-group"></i>
      </div>
      <div class="StatContent">
        <h3>{{ Stats.TotalTeams | persian_digits or '۰' }}</h3>
        <p>تعداد کل تیم‌ها</p>
      </div>
    </div>
    <div class="Card StatCard">
      <div class="StatIcon StatIcon--approved">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="StatContent">
        <h3>{{ Stats.ApprovedTeams | persian_digits or '۰' }}</h3>
        <p>تیم‌های تایید شده</p>
      </div>
    </div>
    <div class="Card StatCard">
      <div class="StatIcon StatIcon--clients">
        <i class="fas fa-user-friends"></i>
      </div>
      <div class="StatContent">
        <h3>{{ Stats.TotalClients | persian_digits or '۰' }}</h3>
        <p>کاربران ثبت شده</p>
      </div>
    </div>
    <div class="Card StatCard">
      <div class="StatIcon StatIcon--leaders">
        <i class="fas fa-user-tie"></i>
      </div>
      <div class="StatContent">
        <h3>{{ Stats.TotalLeaders | persian_digits or '۰' }}</h3>
        <p>تعداد سرپرست‌ها</p>
      </div>
    </div>
    <div class="Card StatCard">
      <div class="StatIcon StatIcon--coaches">
        <i class="fas fa-chalkboard-teacher"></i>
      </div>
      <div class="StatContent">
        <h3>{{ Stats.TotalCoaches | persian_digits or '۰' }}</h3>
        <p>تعداد مربی‌ها</p>
      </div>
    </div>
  </div>

  <div class="ChartGrid">
    <div class="Card Card--chart">
      <h2 class="Card__header">
        <i class="fas fa-chart-pie"></i> پراکندگی استانی شرکت کنندگان
      </h2>
      <div class="ChartContainer"><canvas id="ProvinceChart"></canvas></div>
    </div>
    <div class="Card Card--chart">
      <h2 class="Card__header">
        <i class="fas fa-chart-bar"></i> ۱۰ شهر برتر شرکت کننده
      </h2>
      <div class="ChartContainer"><canvas id="CityChart"></canvas></div>
    </div>
  </div>

  <div class="Card Card--table">
    <h2 class="Card__header">
      <i class="fas fa-credit-card"></i> رسیدهای پرداخت در انتظار تایید
    </h2>
    <div class="UserTableWrapper">
      <table class="UserTable">
        <thead>
          <tr>
            <th>تیم</th>
            <th>کاربر</th>
            <th>مبلغ (ریال)</th>
            <th>برای</th>
            <th>تاریخ</th>
            <th>رسید</th>
            <th class="ActionsHeader">عملیات</th>
          </tr>
        </thead>
        <tbody>
          {% for payment, team_name, client_email in PendingPayments %}
          <tr>
            <td data-label="تیم">{{ team_name }}</td>
            <td data-label="کاربر">{{ client_email }}</td>
            <td data-label="مبلغ">
              {{ payment.Amount | humanize_number | persian_digits }}
            </td>
            <td data-label="برای">
              {{ payment.MembersPaidFor | persian_digits }} نفر
            </td>
            <td data-label="تاریخ">
              {{ payment.UploadDate | formatdate | persian_digits }}
            </td>
            <td data-label="رسید">
              <a
                href="{{ url_for('client.get_receipt', client_id=payment.ClientID, filename=payment.ReceiptFilename) }}"
                target="_blank"
                class="Btn BtnSmall BtnSecondary"
              >
                <i class="fas fa-receipt"></i> مشاهده
              </a>
            </td>
            <td class="Actions">
              <form
                action="{{ url_for('admin.admin_manage_payment', payment_id=payment.PaymentID, action='approve') }}"
                method="POST"
                style="display: inline"
                class="ConfirmAction"
                data-confirm="آیا از تایید این پرداخت اطمینان دارید؟"
              >
                <input
                  type="hidden"
                  name="csrf_token"
                  value="{{ csrf_token() }}"
                />
                <button type="submit" class="Btn BtnSuccess BtnSmall">
                  <i class="fas fa-check"></i> تایید
                </button>
              </form>
              <form
                action="{{ url_for('admin.admin_manage_payment', payment_id=payment.PaymentID, action='reject') }}"
                method="POST"
                style="display: inline"
                class="ConfirmAction"
                data-confirm="آیا از رد کردن این پرداخت اطمینان دارید؟"
              >
                <input
                  type="hidden"
                  name="csrf_token"
                  value="{{ csrf_token() }}"
                />
                <button type="submit" class="Btn BtnDanger BtnSmall">
                  <i class="fas fa-times"></i> رد
                </button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr class="EmptyStateRow">
            <td colspan="7" class="EmptyState">
              <i class="fas fa-check-circle EmptyState__icon"></i>
              در حال حاضر هیچ پرداخت در انتظاری برای بررسی وجود ندارد.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %} {% block Scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (typeof AdminCharts !== "undefined") {
      AdminCharts.initProvinceChart(
        "{{ url_for('api.province_distribution') }}"
      );
      AdminCharts.initCityChart("{{ url_for('api.city_distribution') }}");
    }
    if (typeof FormHelpers !== "undefined") {
      FormHelpers.setupConfirmDialogs();
    }
  });
</script>
{% endblock %}
