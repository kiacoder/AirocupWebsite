{% extends "global/base.html" %}

{% block title %}داشبورد مدیریت | پنل آیروکاپ{% endblock %}

{% block body %}
<div class="admin-page admin-dashboard-page">
  <main class="admin-dashboard" role="main" aria-labelledby="admin-dashboard-title">
    <section class="admin-dashboard__hero" role="banner">
      <div class="admin-dashboard__hero-content">
        <div class="admin-dashboard__welcome">
          <span class="admin-dashboard__welcome-chip" aria-label="نمای کلی امروز">
            <i class="fas fa-star" aria-hidden="true"></i>
            خلاصه امروز
          </span>
          <h1 id="admin-dashboard-title">
            سلام
            {{ admin_greeting_name | default('مدیر محترم', true) | persian_digits }}!
          </h1>
          <p>
            تصویر کلی از وضعیت ثبت‌نام، پرداخت و مکاتبات شرکت‌کنندگان را در این
            صفحه دنبال کنید و سریع‌تر به اقدامات روزانه پاسخ دهید.
          </p>
        </div>

      <div class="admin-dashboard__hero-panels">
        <div class="admin-dashboard__highlights" aria-label="شاخص‌های فوری">
            <div class="admin-dashboard__highlight">
              <span class="admin-dashboard__highlight-label">رسیدهای منتظر تایید</span>
              <strong>{{ pending_payments_count | persian_digits }}</strong>
              <small>نیازمند اقدام</small>
            </div>
            <div class="admin-dashboard__highlight">
              <span class="admin-dashboard__highlight-label">کاربران تازه ثبت‌نام شده</span>
              <strong>{{ stats.new_clients_this_week | default(0, true) | persian_digits }}</strong>
              <small>در هفته جاری</small>
            </div>
            <div class="admin-dashboard__highlight">
              <span class="admin-dashboard__highlight-label">کاربران آنلاین</span>
              <strong>{{ stats.online_users_count | default(0, true) | persian_digits }}</strong>
              <small>فعال در ۵ دقیقه اخیر</small>
            </div>
            <div class="admin-dashboard__highlight">
              <span class="admin-dashboard__highlight-label">بازدید امروز</span>
              <strong>{{ stats.daily_visits | default(0, true) | persian_digits }}</strong>
              <small>تعداد بازدیدهای یکتا</small>
            </div>
            <div class="admin-dashboard__highlight">
              <span class="admin-dashboard__highlight-label">بازدید ۷ روز اخیر</span>
              <strong>{{ stats.weekly_last_count | default(0, true) | persian_digits }}</strong>
              <small>آخرین روز ثبت‌شده</small>
            </div>
          </div>

          <ul class="admin-dashboard__hero-insights" aria-label="جمع‌بندی وضعیت">
            <li>
              <i class="fas fa-check-circle" aria-hidden="true"></i>
              {{ stats.approved_teams | default(0) | persian_digits }} تیم تایید شده
            </li>
            <li>
              <i class="fas fa-hourglass-half" aria-hidden="true"></i>
              {{ pending_payments_count | persian_digits }} پرداخت در انتظار بررسی
            </li>
            <li>
              <i class="fas fa-user-friends" aria-hidden="true"></i>
              {{ stats.total_members | default(0) | persian_digits }} عضو فعال در تیم‌ها
            </li>
          </ul>
        </div>

        <div class="admin-dashboard__cta">
          <a href="#pending-payments" class="btn btn-primary btn-large">
            مدیریت پرداخت‌ها
          </a>
          <a href="{{ url_for('admin.admin_manage_news') }}" class="btn btn-secondary btn-large">
            افزودن خبر جدید
          </a>
          <a href="{{ url_for('admin.admin_download_db') }}" class="btn btn-warning btn-large">
            <i class="fas fa-database"></i> دانلود دیتابیس
          </a>
          <form method="POST" action="{{ url_for('admin.admin_toggle_signup') }}" class="inline-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="disabled" value="{{ 0 if signup_disabled else 1 }}">
            <button type="submit" class="btn {{ 'btn-danger' if signup_disabled else 'btn-success' }} btn-large">
              <i class="fas fa-user-lock"></i>
              {{ 'فعال‌کردن ثبت‌نام' if signup_disabled else 'تعطیل‌کردن ثبت‌نام' }}
            </button>
          </form>
        </div>
      </div>

      <div class="admin-dashboard__hero-visual" aria-label="خلاصه آماری">
        <div class="admin-dashboard__hero-rings" aria-hidden="true">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <dl class="admin-dashboard__hero-metrics">
          <div>
            <dt>تیم‌های فعال</dt>
            <dd>{{ stats.total_teams | default(0) | persian_digits }}</dd>
          </div>
          <div>
            <dt>تیم‌های تایید شده</dt>
            <dd>{{ stats.approved_teams | default(0) | persian_digits }}</dd>
          </div>
          <div>
            <dt>اعضای فعال</dt>
            <dd>{{ stats.total_members | default(0) | persian_digits }}</dd>
          </div>
        </dl>
      </div>
    </section>

    <section class="admin-page__section" aria-label="آمار تفصیلی">
      <div class="admin-dashboard__stats-grid">
        <article class="admin-surface">
          <header class="admin-surface__header">
            <div class="admin-surface__title">
              <h3><i class="fas fa-trophy"></i> محبوبیت لیگ‌ها</h3>
            </div>
          </header>
          <div class="admin-surface__body">
            {% if stats.weekly_visits %}
            <div class="admin-chart-card">
              <h4>بازدید ۷ روز اخیر</h4>
              <div class="sparkline" aria-hidden="true">
                {% for day in stats.weekly_visits %}
                <span style="--v: {{ day.visit_count or 0 }};" title="{{ day.date }}: {{ day.visit_count | persian_digits }}"></span>
                {% endfor %}
              </div>
              <div class="sparkline-legend">
                <span>کمترین: {{ stats.weekly_min | default(0, true) | persian_digits }}</span>
                <span>بیشترین: {{ stats.weekly_max | default(0, true) | persian_digits }}</span>
              </div>
            </div>
            {% endif %}
            <ul class="stat-list">
              {% for league in league_stats %}
              <li class="stat-list__item" style="display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="#" onclick="toggleLeagueTeams(event, {{ league.id }})" class="admin-link">
                      {{ league.name }}
                    </a>
                    <span class="stat-badge">{{ league.count | persian_digits }} تیم</span>
                </div>
                <div id="league-teams-{{ league.id }}" style="display: none; margin-top: 0.5rem; padding-right: 1rem; font-size: 0.9em; color: #555;">
                    <i class="fas fa-spinner fa-spin"></i> در حال بارگذاری...
                </div>
              </li>
              {% else %}
              <li class="stat-list__empty">هیچ تیمی ثبت نشده است.</li>
              {% endfor %}
            </ul>
          </div>
        </article>
        <article class="admin-surface">
          <header class="admin-surface__header">
            <div class="admin-surface__title">
              <h3><i class="fas fa-venus-mars"></i> تفکیک جنسیتی</h3>
            </div>
          </header>
          <div class="admin-surface__body">
            <div class="gender-chart">
              <div class="gender-chart__item gender-chart__item--male">
                <span class="gender-icon"><i class="fas fa-mars"></i></span>
                <div class="gender-info">
                  <strong>آقا</strong>
                  <span>{{ gender_stats.male | persian_digits }} نفر</span>
                  <small>%{{ gender_stats.male_percent | persian_digits }}</small>
                  {% if gender_stats.average_male_age %}
                  <small>میانگین سن: {{ gender_stats.average_male_age | persian_digits }} سال</small>
                  {% endif %}
                </div>
              </div>
              <div class="gender-chart__item gender-chart__item--female">
                <span class="gender-icon"><i class="fas fa-venus"></i></span>
                <div class="gender-info">
                  <strong>خانم</strong>
                  <span>{{ gender_stats.female | persian_digits }} نفر</span>
                  <small>%{{ gender_stats.female_percent | persian_digits }}</small>
                  {% if gender_stats.average_female_age %}
                  <small>میانگین سن: {{ gender_stats.average_female_age | persian_digits }} سال</small>
                  {% endif %}
                </div>
              </div>
            </div>
            {% if stats.gender_by_league %}
            <div class="gender-league-table">
              <div class="gender-league-table__head">
                <span>لیگ</span>
                <span>آقا</span>
                <span>خانم</span>
                <span>نامشخص</span>
              </div>
              {% for row in stats.gender_by_league %}
              <div class="gender-league-table__row">
                <span class="gender-league-table__league">{{ row.league }}</span>
                <span class="gender-league-table__val">{{ row.male | persian_digits }}</span>
                <span class="gender-league-table__val">{{ row.female | persian_digits }}</span>
                <span class="gender-league-table__val">{{ row.unknown | persian_digits }}</span>
              </div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </article>
        <div class="stats-column">
          <article class="admin-surface">
            <header class="admin-surface__header">
              <div class="admin-surface__title">
                <h3><i class="fas fa-arrows-alt-h"></i> جابجایی سریع عضو</h3>
              </div>
            </header>
            <div class="admin-surface__body">
              <form class="form-inline-grid" method="POST" action="{{ url_for('admin.admin_move_member') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="form-group">
                  <label for="member_id">شناسه عضو</label>
                  <input type="number" id="member_id" name="member_id" min="1" required placeholder="مثال: 125" />
                </div>
                <div class="form-group">
                  <label for="target_team_id">تیم مقصد</label>
                  <input type="number" id="target_team_id" name="team_id" min="1" required placeholder="مثال: 45" />
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                  <i class="fas fa-random"></i> انتقال عضو
                </button>
              </form>
            </div>
          </article>
          <article class="admin-surface">
            <header class="admin-surface__header">
              <div class="admin-surface__title">
                <h3><i class="fas fa-server"></i> وضعیت سرور</h3>
              </div>
            </header>
            <div class="admin-surface__body">
              <div class="server-stat">
                <label>CPU: %{{ server_stats.cpu_percent | default(0, true) | persian_digits }}</label>
                <div class="progress-bar">
                  <div class="progress-bar__fill" style="width: {{ server_stats.cpu_percent | default(0) }}%;"></div>
                </div>
                <span class="progress-text">Load 1m: {{ server_stats.load_avg_1m | default(0, true) | persian_digits }}</span>
              </div>
              <div class="server-stat" style="margin-top: 0.75rem;">
                <label>حافظه (RAM): {{ server_stats.ram_used_gb | default(0, true) | persian_digits }} / {{ server_stats.ram_total_gb | default(0, true) | persian_digits }} GB</label>
                <div class="progress-bar">
                  <div class="progress-bar__fill" style="width: {{ server_stats.ram_percent | default(0) }}%;"></div>
                </div>
                <span class="progress-text">%{{ server_stats.ram_percent | default(0, true) | persian_digits }} در حال استفاده</span>
              </div>
              {% if server_stats.gpu_percent is not none %}
              <div class="server-stat" style="margin-top: 0.75rem;">
                <label>GPU: %{{ server_stats.gpu_percent | persian_digits }}</label>
                <div class="progress-bar">
                  <div class="progress-bar__fill" style="width: {{ server_stats.gpu_percent }}%;"></div>
                </div>
                <span class="progress-text">VRAM: {{ server_stats.vram_used_gb | default(0, true) | persian_digits }} / {{ server_stats.vram_total_gb | default(0, true) | persian_digits }} GB</span>
              </div>
              {% endif %}
              <div class="server-stat" style="margin-top: 0.75rem;">
                <label>فضای دیسک ({{ server_stats.disk_free_gb | persian_digits }} GB آزاد)</label>
                <div class="progress-bar">
                  <div class="progress-bar__fill" style="width: {{ server_stats.disk_percent }}%;"></div>
                </div>
                <span class="progress-text">%{{ server_stats.disk_percent | persian_digits }} پر شده از {{ server_stats.disk_total_gb | persian_digits }} GB</span>
              </div>
            </div>
          </article>

          <article class="admin-surface" style="margin-top: 1.5rem;">
            <header class="admin-surface__header">
              <div class="admin-surface__title">
                <h3><i class="fas fa-newspaper"></i> اخبار پربازدید</h3>
              </div>
            </header>
            <div class="admin-surface__body">
              <ul class="compact-list">
                {% for news in top_news %}
                <li>
                  <a href="{{ url_for('admin.admin_edit_news', article_id=news.news_id) }}" class="text-truncate">
                    {{ news.title }}
                  </a>
                  <span class="view-count"><i class="fas fa-eye"></i> {{ news.views | default(0) | persian_digits }}</span>
                </li>
                {% else %}
                <li class="stat-list__empty">خبری یافت نشد.</li>
                {% endfor %}
              </ul>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section class="admin-page__section" aria-label="اقدامات سریع">
      <article class="admin-surface admin-dashboard__actions">
        <header class="admin-surface__header">
          <div class="admin-surface__title">
            <h2><i class="fas fa-bolt" aria-hidden="true"></i> میانبرهای مدیریتی</h2>
            <p>دسترسی سریع به کلیدی‌ترین صفحات برای مدیریت کاربران، تیم‌ها و محتوا.</p>
          </div>
        </header>
        <div class="admin-surface__body">
          <div class="admin-dashboard__actions-grid">
            <a href="{{ url_for('admin.admin_clients_list') }}" class="admin-action-card">
              <i class="fas fa-users" aria-hidden="true"></i>
              <span>مدیریت کاربران</span>
              <small>ویرایش اطلاعات و دسترسی‌ها</small>
            </a>
            <a href="{{ url_for('admin.admin_manage_teams') }}" class="admin-action-card">
              <i class="fas fa-layer-group" aria-hidden="true"></i>
              <span>مدیریت تیم‌ها</span>
              <small>بررسی مدارک و وضعیت تیم‌ها</small>
            </a>
            <a href="{{ url_for('admin.admin_manage_news') }}" class="admin-action-card">
              <i class="fas fa-newspaper" aria-hidden="true"></i>
              <span>مدیریت اخبار</span>
              <small>انتشار اطلاعیه‌های جدید</small>
            </a>
            <a href="{{ url_for('admin.admin_search') }}" class="admin-action-card">
              <i class="fas fa-search" aria-hidden="true"></i>
              <span>جستجوی پیشرفته</span>
              <small>یافتن سریع کاربران، تیم‌ها و پرداخت‌ها</small>
            </a>
            <a href="{{ url_for('admin.admin_select_chat') }}" class="admin-action-card">
              <i class="fas fa-envelope" aria-hidden="true"></i>
              <span>پیام‌ها</span>
              <small>پاسخ به سوالات شرکت‌کنندگان</small>
            </a>
            <a href="{{ url_for('admin.admin_pending_documents') }}" class="admin-action-card">
              <i class="fas fa-file-alt" aria-hidden="true"></i>
              <span>مستندات</span>
              <small>بررسی مدارک ارسال شده</small>
            </a>
          </div>
        </div>
      </article>
    </section>

    <section class="admin-page__section" aria-label="شاخص‌های رقابت">
      <article class="admin-surface">
        <header class="admin-surface__header">
          <div class="admin-surface__title">
            <h2><i class="fas fa-chart-line" aria-hidden="true"></i> شاخص‌های اصلی رقابت</h2>
            <p>نمایی سریع از وضعیت کلی شرکت‌کنندگان و تیم‌ها در سامانه.</p>
          </div>
        </header>
        <div class="admin-surface__body">
          <div class="admin-dashboard__stats">
            <div class="admin-metric-card">
              <div class="admin-metric-card__icon"><i class="fas fa-users" aria-hidden="true"></i></div>
              <div>
                <h3>{{ stats.total_members | default(0) | persian_digits }}</h3>
                <p>کل شرکت کنندگان</p>
              </div>
            </div>
            <div class="admin-metric-card">
              <div class="admin-metric-card__icon"><i class="fas fa-layer-group" aria-hidden="true"></i></div>
              <div>
                <h3>{{ stats.total_teams | default(0) | persian_digits }}</h3>
                <p>تعداد کل تیم‌ها</p>
              </div>
            </div>
            <div class="admin-metric-card">
              <div class="admin-metric-card__icon"><i class="fas fa-check-circle" aria-hidden="true"></i></div>
              <div>
                <h3>
                  {{ stats.approved_teams | default(0) | persian_digits }}
                </h3>
                <p>تیم‌های تایید شده</p>
              </div>
            </div>
            <div class="admin-metric-card">
              <div class="admin-metric-card__icon"><i class="fas fa-user-friends" aria-hidden="true"></i></div>
              <div>
                <h3>{{ stats.total_clients | default(0) | persian_digits }}</h3>
                <p>کاربران ثبت شده</p>
              </div>
            </div>
            <div class="admin-metric-card">
              <div class="admin-metric-card__icon"><i class="fas fa-user-tie" aria-hidden="true"></i></div>
              <div>
                <h3>{{ stats.total_leaders | default(0) | persian_digits }}</h3>
                <p>تعداد سرپرست‌ها</p>
              </div>
            </div>
            <div class="admin-metric-card">
              <div class="admin-metric-card__icon"><i class="fas fa-chalkboard-teacher" aria-hidden="true"></i></div>
              <div>
                <h3>{{ stats.total_coaches | default(0) | persian_digits }}</h3>
                <p>تعداد مربی‌ها</p>
              </div>
            </div>
          </div>
        </div>
      </article>
    </section>

    <section class="admin-page__section">
      <div class="admin-dashboard__charts">
        <article class="admin-chart-card">
          <header>
            <i class="fas fa-chart-pie"></i>
            <h3>پراکندگی استانی شرکت کنندگان</h3>
          </header>
          <div class="admin-chart-card__body">
            <canvas
              id="provinceChart"
              data-endpoint="{{ url_for('api_province_distribution') }}"
            ></canvas>
          </div>
        </article>
        <article class="admin-chart-card">
          <header>
            <i class="fas fa-chart-bar"></i>
            <h3>۱۰ شهر برتر شرکت کننده</h3>
          </header>
          <div class="admin-chart-card__body">
            <canvas
              id="cityChart"
              data-endpoint="{{ url_for('api_city_distribution') }}"
            ></canvas>
          </div>
        </article>
      </div>
    </section>

    <section class="admin-page__section" id="pending-payments" aria-label="رسیدهای در انتظار">
      <article class="admin-dashboard__table">
        <header class="admin-dashboard__table-header">
          <div>
            <h2><i class="fas fa-credit-card" aria-hidden="true"></i> رسیدهای پرداخت در انتظار تایید</h2>
            <p>در صورت تایید، وضعیت تیم‌ها به‌روزرسانی خواهد شد.</p>
          </div>
          <span class="admin-dashboard__badge"
            >{{ pending_payments_count | persian_digits }} مورد</span
          >
        </header>

        <div class="admin-table-wrapper">
          <table class="admin-table">
            <caption class="sr-only">لیست رسیدهای پرداخت در انتظار تایید</caption>
            <thead>
              <tr>
                <th>تیم</th>
                <th>کاربر</th>
                <th>مبلغ ارسالی (ریال)</th>
                <th>جزئیات محاسبه</th>
                <th>اطلاعات واریز</th>
                <th>رسید</th>
                <th>عملیات</th>
              </tr>
            </thead>
            <tbody>
              {% for payment in pending_payments %}
              <tr>
                <td>
                  <div class="admin-table__cell-title">
                    <a
                      href="{{ url_for('admin.admin_manage_client', client_id=payment.client_id) }}#team-{{ payment.team_id }}"
                      class="admin-link"
                    >
                      {{ payment.team_name }}
                    </a>
                  </div>
                  <div class="admin-table__cell-subtitle">
                    کد تیم: #{{ payment.team_id | persian_digits }}
                    {% if payment.league_one_name %}
                    <span aria-hidden="true">•</span>
                    لیگ‌ها:
                    {{ payment.league_one_name }}
                    {% if payment.league_two_name %}
                      و {{ payment.league_two_name }}
                    {% endif %}
                    {% endif %}
                    {% if payment.education_level %}
                    <span aria-hidden="true">•</span>
                    مقطع: {{ payment.education_level }}
                    {% endif %}
                  </div>
                </td>
                <td>
                  <div class="admin-table__cell-title">
                    <a
                      href="{{ url_for('admin.admin_manage_client', client_id=payment.client_id) }}"
                      class="admin-link"
                    >
                      {{ payment.client_email }}
                    </a>
                  </div>
                  <div class="admin-table__cell-subtitle">
                    {{ payment.client_phone | default('—', true) |
                    persian_digits }}
                  </div>
                </td>
                <td>{{ payment.amount | humanize_number | persian_digits }}</td>
                <td>
                  {% set expected = payment.expected_payment %}
                  {% if expected.expected_amount is not none %}
                  <div class="admin-table__cell-title">
                    {{ expected.expected_amount | humanize_number | persian_digits }} ریال
                  </div>
                  <div class="admin-table__cell-subtitle">
                    {% if expected.is_new_member_payment %}
                    اعضای جدید: {{ expected.members_count | persian_digits }} نفر ×
                    {{ expected.per_member_fee | humanize_number | persian_digits }}
                    {% else %}
                    ثبت‌نام اولیه {{ expected.members_count | persian_digits }} عضو
                    {% if expected.selected_leagues_count > 1 %}
                    ({{ expected.selected_leagues_count | persian_digits }} لیگ)
                    {% endif %}
                    {% if expected.league_two_cost %}
                    <span class="admin-badge">تخفیف لیگ ۲:
                      {{ expected.discount_amount | humanize_number | persian_digits }}</span>
                    {% endif %}
                    {% endif %}
                  </div>
                  {% else %}
                  <div class="admin-table__cell-subtitle text-error">
                    {{ expected.status_note or 'اطلاعات محاسبه کامل نیست.' }}
                  </div>
                  {% endif %}
                  <div class="admin-table__cell-subtitle">
                    ارسال شده برای {{ payment.members_paid_for | persian_digits }} عضو
                    {% if payment.unpaid_members %}
                    <span class="admin-badge admin-badge--muted">
                      اعضای ثبت‌نشده: {{ payment.unpaid_members | persian_digits }}
                    </span>
                    {% endif %}
                  </div>
                </td>
                <td>
                  <div class="admin-table__cell-title">
                    {% if payment.paid_at %}
                    تاریخ و ساعت واریز:
                    <strong>{{ payment.paid_at.strftime('%Y-%m-%d %H:%M') | persian_digits }}</strong>
                    {% else %}
                    تاریخ واریز نامشخص
                    {% endif %}
                  </div>
                  <div class="admin-table__cell-subtitle">
                    {% if payment.tracking_number %}
                    شماره پیگیری: <span dir="ltr">{{ payment.tracking_number | persian_digits }}</span>
                    {% else %}
                    شماره پیگیری ثبت نشده است.
                    {% endif %}
                  </div>
                  <div class="admin-table__cell-subtitle">
                    {% if payment.payer_name %}
                    پرداخت‌کننده: {{ payment.payer_name }}
                    {% endif %}
                    {% if payment.payer_phone %}
                    <span aria-hidden="true">•</span>
                    تماس: <span dir="ltr">{{ payment.payer_phone | persian_digits }}</span>
                    {% endif %}
                  </div>
                  <div class="admin-table__cell-subtitle admin-badge admin-badge--muted">
                    ارسال رسید در سایت: {{ payment.upload_date | formatdate | persian_digits }}
                  </div>
                </td>
                <td>
                  <a
                    href="{{ url_for('uploaded_receipt_file', client_id=payment.client_id, filename=payment.receipt_filename) }}"
                    class="btn btn-secondary btn-small"
                    target="_blank"
                    rel="noopener"
                  >
                    مشاهده رسید
                  </a>
                </td>
                <td class="admin-table__actions">
                  <form
                    method="POST"
                    action="{{ url_for('admin.admin_manage_payment', payment_id=payment.payment_id, action='approve') }}"
                    class="inline-form"
                    aria-label="تایید پرداخت {{ payment.team_name }}"
                  >
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" class="btn btn-success btn-small">
                      <i class="fas fa-check" aria-hidden="true"></i>
                      تایید
                    </button>
                  </form>
                  <form
                    method="POST"
                    action="{{ url_for('admin.admin_manage_payment', payment_id=payment.payment_id, action='reject') }}"
                    class="inline-form"
                    aria-label="رد پرداخت {{ payment.team_name }}"
                  >
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" class="btn btn-danger btn-small">
                      <i class="fas fa-times" aria-hidden="true"></i>
                      رد
                    </button>
                  </form>
                </td>
              </tr>
              {% else %}
              <tr class="empty-state-card">
                <td colspan="7">
                  <div class="admin-empty-state">
                    <i class="fas fa-credit-card" aria-hidden="true"></i>
                    همه پرداخت‌ها بررسی شده‌اند!
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </article>
    </section>
  </main>
</div>
<script>
async function toggleLeagueTeams(event, leagueId) {
    event.preventDefault();
    const container = document.getElementById(`league-teams-${leagueId}`);
    if (container.style.display === 'none') {
        if (container.dataset.loaded !== 'true') {
             try {
                 const response = await fetch(`/API/GetTeamsByLeague/${leagueId}`);
                 const teams = await response.json();
                 container.innerHTML = '';
                 if (teams.length > 0) {
                     const ul = document.createElement('ul');
                     ul.style.listStyle = 'disc inside';
                     teams.forEach(name => {
                         const li = document.createElement('li');
                         li.textContent = name;
                         ul.appendChild(li);
                     });
                     container.appendChild(ul);
                 } else {
                     container.textContent = 'تیمی یافت نشد.';
                 }
                 container.dataset.loaded = 'true';
             } catch (e) {
                 console.error(e);
                 container.textContent = 'خطا در دریافت اطلاعات.';
             }
        }
        container.style.display = 'block';
    } else {
        container.style.display = 'none';
    }
}
</script>
{% endblock %}
