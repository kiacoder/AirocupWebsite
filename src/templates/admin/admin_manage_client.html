{% extends "global/base.html" %} {% block title %}مدیریت کاربر: {{ Client.Email
}} | پنل آیروکاپ{% endblock %} {% block body %}
<div class="Container">
  <div class="PageHeader">
    <h1 class="SectionTitle">مدیریت کاربر: {{ Client.Email }}</h1>
    <p class="FormSubtitle">
      اطلاعات کاربر و تیم‌های ثبت شده توسط او را مدیریت کنید.
    </p>
  </div>

  <div class="Card">
    <h2 class="Card__header">
      <i class="fas fa-user-circle"></i> اطلاعات کاربر
    </h2>
    <div class="Card__body" style="padding: 1.5rem">
      <dl class="InfoList">
        <dt>ایمیل:</dt>
        <dd>{{ Client.Email }}</dd>
        <dt>شماره تماس:</dt>
        <dd>{{ Client.PhoneNumber | persian_digits }}</dd>
        <dt>تاریخ ثبت نام:</dt>
        <dd>{{ Client.RegistrationDate | formatdate | persian_digits }}</dd>
        <dt>سطح تحصیلات:</dt>
        <dd>{{ Client.EducationLevel or 'ثبت نشده' }}</dd>
      </dl>
    </div>
    <div class="ClientActions">
      <button class="Btn BtnPrimary" data-modal-target="EditClientModal">
        <i class="fas fa-edit"></i> ویرایش حساب
      </button>
      <a
        href="{{ url_for('admin.admin_chat', client_id=Client.ClientID) }}"
        class="Btn BtnSecondary"
        ><i class="fas fa-comments"></i> چت با کاربر</a
      >
    </div>
  </div>

  <div class="Card Card--table">
    <h2 class="Card__header">
      <i class="fas fa-layer-group"></i> تیم‌های ثبت شده توسط کاربر
      <button class="Btn BtnPrimary" data-modal-target="AddTeamModal">
        <i class="fas fa-plus"></i> افزودن تیم
      </button>
    </h2>
    <div class="UserTableWrapper">
      <table class="UserTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>نام تیم</th>
            <th>اعضا</th>
            <th>وضعیت پرداخت</th>
            <th class="ActionsHeader">عملیات</th>
          </tr>
        </thead>
        <tbody>
          {% for TeamData in Teams %}
          <tr>
            <td data-label="ID">#{{ TeamData.TeamID | persian_digits }}</td>
            <td data-label="نام تیم">{{ TeamData.TeamName }}</td>
            <td data-label="اعضا">
              {{ TeamData.TotalMembers | persian_digits }} نفر
            </td>
            <td data-label="وضعیت پرداخت">
              {% set status_enum = TeamData.LastPaymentStatus %}
              <span
                class="StatusBadge {% if status_enum == 'Approved' %}StatusApproved{% elif status_enum == 'Pending' %}StatusPending{% elif status_enum == 'Rejected' %}StatusRejected{% else %}StatusNotStarted{% endif %}"
              >
                {{ status_enum.label if status_enum else 'شروع نشده' }}
              </span>
            </td>
            <td class="Actions">
              <a
                href="{{ url_for('admin.admin_edit_team', team_id=TeamData.TeamID) }}"
                class="Btn BtnPrimary"
                ><i class="fas fa-edit"></i> مدیریت</a
              >
              <form
                method="POST"
                action="{{ url_for('admin.admin_delete_team', team_id=TeamData.TeamID) }}"
              >
                <input
                  type="hidden"
                  name="csrf_token"
                  value="{{ csrf_token() }}"
                />
                <button
                  type="button"
                  class="Btn BtnDanger DeleteBtn"
                  data-modal-title="تایید آرشیو تیم"
                  data-modal-text="آیا از آرشیو کردن تیم «{{ TeamData.TeamName }}» و تمام اعضای آن اطمینان دارید؟"
                  data-modal-confirm="بله، آرشیو کن"
                >
                  <i class="fas fa-archive"></i> آرشیو
                </button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr class="EmptyStateRow">
            <td colspan="5">این کاربر هنوز تیمی ثبت نکرده است.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="SectionCta">
    <a href="{{ url_for('admin.admin_clients_list') }}" class="Btn BtnSecondary"
      ><i class="fas fa-arrow-left"></i> بازگشت به لیست کاربران</a
    >
  </div>
</div>

<div id="EditClientModal" class="Modal" aria-hidden="true">
  <div class="ModalContent">
    <button class="CloseBtn" data-dismiss="modal" aria-label="بستن">
      &times;
    </button>
    <h2 class="FormTitle">ویرایش حساب کاربر</h2>
    <form
      id="editClientForm"
      method="POST"
      action="{{ url_for('admin.admin_edit_client', client_id=Client.ClientID) }}"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="FormGroup">
        <label for="EditEmail">ایمیل</label>
        <input
          type="email"
          id="EditEmail"
          name="Email"
          value="{{ Client.Email }}"
          required
          dir="ltr"
          class="FormControl"
        />
      </div>
      <div class="FormGroup">
        <label for="EditPhone">شماره تلفن</label>
        <input
          type="tel"
          id="EditPhone"
          name="PhoneNumber"
          value="{{ Client.PhoneNumber }}"
          required
          dir="ltr"
          class="FormControl"
        />
      </div>
      <div class="FormGroup">
        <label for="EditPassword">رمز عبور جدید (اختیاری)</label>
        <div class="PasswordWrapper">
          <input
            type="password"
            id="EditPassword"
            name="Password"
            placeholder="برای تغییر، رمز جدید را وارد کنید"
            dir="ltr"
            class="FormControl"
          />
          <button
            type="button"
            class="PasswordToggle"
            id="EditPasswordToggle"
            data-target="#EditPassword"
          >
            <i class="fas fa-eye-slash"></i>
          </button>
        </div>
      </div>
      <div class="FormGroup">
        <button type="submit" class="Btn BtnPrimary Btn--fullWidth">
          ذخیره تغییرات
        </button>
      </div>
    </form>
  </div>
</div>

<div id="AddTeamModal" class="Modal" aria-hidden="true">
  <div class="ModalContent">
    <button class="CloseBtn" data-dismiss="modal" aria-label="بستن">
      &times;
    </button>
    <h2 class="FormTitle">افزودن تیم جدید برای {{ Client.Email }}</h2>
    <form
      id="addTeamForm"
      method="POST"
      action="{{ url_for('admin.admin_add_team', client_id=Client.ClientID) }}"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="FormGroup">
        <label for="AddTeamName">نام تیم</label>
        <input
          type="text"
          id="AddTeamName"
          name="TeamName"
          required
          class="FormControl"
        />
      </div>
      <div class="FormGroup">
        <button type="submit" class="Btn BtnPrimary Btn--fullWidth">
          ساخت تیم
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
