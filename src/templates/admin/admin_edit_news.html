{% extends "global/base.html" %}

{% block Title %}ویرایش خبر: {{ Article.Title | truncate(30) }} | پنل آیروکاپ{% endblock %}

{% block Body %}
<div class="Container">
  <div class="PageHeader">
    <h1 class="SectionTitle">ویرایش خبر</h1>
    <p class="FormSubtitle">ویرایش خبر «{{ Article.Title }}»</p>
  </div>

  <div class="FormContainer FormContainer--large">
    <form method="POST" action="{{ url_for('Admin.AdminEditNews', ArticleID=Article.NewsID) }}" enctype="multipart/form-data" id="editNewsForm">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

      <div class="FormGroup">
        <label for="Title" class="FormLabel">عنوان خبر *</label>
        <input type="text" id="Title" name="Title" value="{{ Article.Title }}" required class="FormControl" maxlength="200" />
      </div>

      <div class="FormGroup">
        <label for="Content" class="FormLabel">محتوای خبر *</label>
        <textarea id="Content" name="Content" rows="12" required class="FormControl" placeholder="متن کامل خبر را اینجا وارد کنید...">{{ Article.Content }}</textarea>
      </div>

      <div class="FormGroup">
        <label for="TemplatePath" class="FormLabel">مسیر قالب اختصاصی (اختیاری)</label>
        <input type="text" id="TemplatePath" name="TemplatePath" value="{{ Article.TemplatePath or '' }}" placeholder="مثال: News/custom_article.html" class="FormControl" />
        <p class="FormHelpText">
          برای استفاده از قالب پیش‌فرض، این فیلد را خالی بگذارید. مسیر باید نسبت به پوشه Templates باشد.
        </p>
      </div>

      <div class="FormGroup">
        <label for="Image" class="FormLabel">تصویر جدید (اختیاری)</label>
        <p class="FormHelpText">
          برای جایگزین کردن تصویر فعلی، فایل جدیدی را انتخاب کنید. در غیر این صورت، این فیلد را خالی بگذارید. فرمت‌های مجاز: JPG, PNG, GIF.
        </p>
        <input type="file" id="Image" name="Image" accept=".jpg,.jpeg,.png,.gif" class="FormControl" />
      </div>

      {% if Article.ImagePath %}
      <div class="FormGroup">
        <label class="FormLabel">تصویر فعلی</label>
        <div class="ImagePreviewContainer">
          <img class="ImagePreview" src="{{ url_for('Admin.UploadedNewsImage', filename=Article.ImagePath) }}" alt="{{ Article.Title }}" onerror="this.style.display='none'" />
          <p class="FormHelpText">مسیر فایل: {{ Article.ImagePath }}</p>
        </div>
      </div>
      {% endif %}

      <div class="FormGrid FormGrid--2">
        <button type="submit" class="Btn BtnPrimary Btn--fullWidth">
          <i class="fas fa-save"></i> ذخیره تغییرات
        </button>
        <a href="{{ url_for('Admin.AdminManageNews') }}" class="Btn BtnSecondary Btn--fullWidth">
          <i class="fas fa-times"></i> انصراف
        </a>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block Scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("editNewsForm");
    const fileInput = document.getElementById("Image");

    if (fileInput) {
      fileInput.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 50 * 1024 * 1024) { // 50MB
            alert("حجم فایل نباید بیشتر از ۵۰ مگابایت باشد.");
            e.target.value = "";
          }
        }
      });
    }

    if (form) {
      form.addEventListener("submit", function (e) {
        const title = document.getElementById("Title").value.trim();
        const content = document.getElementById("Content").value.trim();

        if (!title || !content) {
          e.preventDefault();
          alert("لطفا عنوان و محتوای خبر را وارد کنید.");
          return false;
        }
      });
    }
  });
</script>
{% endblock %}