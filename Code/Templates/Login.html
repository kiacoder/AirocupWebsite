{% extends "Global/Base.html" %}

{% block Title %}ورود به حساب کاربری | آیروکاپ{% endblock %}

{% block Body %}
<div class="AppContainer">
  <div class="FormContainer FormContainer--large">
    <form method="POST" action="{{ url_for('Client.Login') }}" id="LoginForm" novalidate>
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <input type="hidden" name="next" value="{{ next_url or '' }}" />

      <h1 class="FormTitle">ورود به حساب کاربری</h1>

      <div class="FormGroup">
        <label for="identifier">ایمیل یا شماره موبایل:</label>
        <input type="text" id="identifier" name="Identifier" placeholder="ایمیل یا شماره موبایل خود را وارد کنید" required autofocus dir="ltr" />
        <span class="ErrorMsg" id="identifierError"></span>
      </div>

      <div class="FormGroup">
        <label for="password">رمز عبور:</label>
        <div class="PasswordWrapper">
          <input type="password" id="password" name="Password" required dir="ltr" />
          <button type="button" class="PasswordToggle" id="password-toggle" data-target="#password" aria-label="Show password">
            <i class="fas fa-eye-slash"></i>
          </button>
        </div>
      </div>

      <div class="FormGroup">
        <button type="submit" class="Btn BtnPrimary Btn--fullWidth">
          ورود
        </button>
      </div>

      <div class="FormLinks" style="text-align: center">
        <p>
          <a href="{{ url_for('Client.ForgotPassword') }}">رمز عبور خود را فراموش کرده‌اید؟</a>
        </p>
        <p>
          هنوز حساب کاربری ندارید؟
          <a href="{{ url_for('Client.SignUp') }}">اینجا ثبت‌نام کنید.</a>
        </p>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block Scripts %}
{{ super() }}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const loginForm = document.getElementById("LoginForm");
    const identifierInput = document.getElementById("identifier");
    const identifierError = document.getElementById("identifierError");

    if (loginForm) {
        loginForm.addEventListener("submit", function (event) {
            const value = identifierInput.value.trim();
            if (!Validators.IsValidEmail(value) && !Validators.IsValidIranianPhone(value)) {
                event.preventDefault();
                identifierError.textContent = "لطفا یک ایمیل یا شماره موبایل معتبر وارد کنید.";
                identifierInput.focus();
            } else {
                identifierError.textContent = "";
            }
        });
    }

    const passwordToggle = document.getElementById('password-toggle');
    if (passwordToggle) {
        passwordToggle.addEventListener('click', function() {
            const targetInput = document.querySelector(this.dataset.target);
            if (targetInput) {
                const isPassword = targetInput.type === 'password';
                targetInput.type = isPassword ? 'text' : 'password';
                this.querySelector('i').classList.toggle('fa-eye-slash', !isPassword);
                this.querySelector('i').classList.toggle('fa-eye', isPassword);
            }
        });
    }
});
</script>
{% endblock %}